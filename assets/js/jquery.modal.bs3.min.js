(function(b){var a={init:function(){this.bindToggle();this.bindClose();b(document).ajaxComplete(b.proxy(this.ajaxComplete,this))},ajaxComplete:function(){this.bindClose()},bindToggle:function(){b("[data-toggle=modal]").on("click",function(){var d=b(this),c=d.attr("href");if(!c){return false}b.ajax({url:c,dataType:"json",error:function(e,g,f){if(e.status==301){location.href=e.responseJSON.result.data.url;closeModal(e.responseJSON,$form);return}},success:function(e,h,g){if(typeof e=="undefined"){return}if(e.result.html&&e.result.data.id){var f=b(e.result.html);b("body").find(".modal").remove();f.appendTo("body").modal("show");if(typeof e.result.data.url!=="undefined"){history.pushState(null,null,e.result.data.url)}}}});return false})},bindClose:function(){b(".modal").on("hide.bs.modal",function(d){var c=b(this);c.find("iframe").each(function(){var e=b(this);e.attr("src",e.attr("src").replace("autoplay=1","autoplay=0"))});c.find("audio, video").each(function(){this.pause()});history.pushState(null,null,c.data("back"))})}};b(function(){a.init()})})(jQuery);