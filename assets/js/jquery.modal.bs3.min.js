(function(b){var a={init:function(){this.bindToggle();this.bindClose();this.bindPopState();b(document).ajaxComplete(b.proxy(this.ajaxComplete,this))},ajaxComplete:function(){this.bindClose(true)},bindToggle:function(){var c=this;b("body").on("click","[data-toggle=modal]",function(){var f=b(this),d=f.attr("href");var e=HASTE_PLUS.getParameterByName("ag",d);if(f.data("event")=="modal"||f.data("news")=="modal"||f.data("job")=="modal"){return}if(typeof d=="undefined"){d=f.attr("xlink:href")}if(e!="modal"){window.location.href=d;return false}if(typeof d=="undefined"){return false}b.ajax({url:d,data:{location:window.location.href},dataType:"json",error:function(g,i,h){if(g.status==300){location.href=g.responseJSON.result.data.url;closeModal(g.responseJSON,$form);return}},success:function(h,k,j){if(typeof h=="undefined"){return}if(h.result.html&&h.result.data.id){var g=b(h.result.html);b("body").find(".bs-modal").remove();g.appendTo("body");var i=b(".bs-modal");i.modal("show");if(typeof h.result.data.url!=="undefined"){if(window.history&&window.history.pushState){history.pushState({},null,h.result.data.url)}}}}});return false})},bindClose:function(c){b(".bs-modal").on("hide.bs.modal",function(f){var d=b(this);d.find("iframe").each(function(){var e=b(this);e.attr("src",e.attr("src").replace("autoplay=1","autoplay=0"))});d.find("audio, video").each(function(){this.pause()});if(window.history&&window.history.pushState){history.pushState({},null,d.data("back"))}})},bindPopState:function(){b(window).on("popstate",function(){b(".bs-modal").modal("hide")})}};b(function(){a.init()})})(jQuery);