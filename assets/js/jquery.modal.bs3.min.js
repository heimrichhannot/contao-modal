(function(b){var a={init:function(){this.bindToggle();this.bindClose();this.bindPopState();b(document).ajaxComplete(b.proxy(this.ajaxComplete,this))},ajaxComplete:function(){this.bindClose(true)},bindToggle:function(){var c=this;b("body").on("click","[data-toggle=modal]",function(){var f=b(this),d=f.attr("href");var e=HASTE_PLUS.getParameterByName("ag",d);if(f.data("event")=="modal"||f.data("news")=="modal"||f.data("job")=="modal"){return}if(typeof d=="undefined"){d=f.attr("xlink:href")}var g=d||f.data("target");if(b(g).length>0){return}if(e!="modal"){window.location.href=d;return false}if(typeof d=="undefined"){return false}b.ajax({url:d,data:{location:window.location.href},dataType:"json",error:function(h,j,i){if(h.status==300){location.href=h.responseJSON.result.data.url;closeModal(h.responseJSON,$form);return}},success:function(i,l,k){if(typeof i=="undefined"){return}if(i.result.html&&i.result.data.id){var h=b(i.result.html);b("body").find(".bs-modal").remove();h.appendTo("body");var j=b(".bs-modal");j.modal("show");if(typeof i.result.data.url!=="undefined"){if(window.history&&window.history.pushState){history.pushState({},null,i.result.data.url)}}}}});return false})},bindClose:function(c){b(".bs-modal").on("hide.bs.modal",function(f){var d=b(this);d.find("iframe").each(function(){var e=b(this);e.attr("src",e.attr("src").replace("autoplay=1","autoplay=0"))});d.find("audio, video").each(function(){this.pause()});if(window.history&&window.history.pushState){history.pushState({},null,d.data("back"))}})},bindPopState:function(){b(window).on("popstate",function(){b(".bs-modal").modal("hide")})}};b(function(){a.init()})})(jQuery);