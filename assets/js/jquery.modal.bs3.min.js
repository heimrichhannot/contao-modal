(function(b){var a={init:function(){this.bindToggle();this.bindClose();this.bindPopState();b(document).ajaxComplete(b.proxy(this.ajaxComplete,this))},ajaxComplete:function(){this.bindClose(true)},bindToggle:function(){b("[data-toggle=modal]").on("click",function(){var e=b(this),c=e.attr("href");var d=HASTE_PLUS.getParameterByName("ag",c);if(typeof c=="undefined"){c=e.attr("xlink:href")}if(d!="modal"){window.location.href=c;return false}if(typeof c=="undefined"){return false}b.ajax({url:c,data:{location:window.location.href},dataType:"json",error:function(f,h,g){if(f.status==300){location.href=f.responseJSON.result.data.url;closeModal(f.responseJSON,$form);return}},success:function(f,i,h){if(typeof f=="undefined"){return}if(f.result.html&&f.result.data.id){var g=b(f.result.html);b("body").find(".bs-modal").remove();g.appendTo("body").modal("show");if(typeof f.result.data.url!=="undefined"){if(window.history&&window.history.pushState){history.pushState({},null,f.result.data.url)}}}}});return false})},bindClose:function(c){b(".bs-modal").on("hide.bs.modal",function(f){var d=b(this);d.find("iframe").each(function(){var e=b(this);e.attr("src",e.attr("src").replace("autoplay=1","autoplay=0"))});d.find("audio, video").each(function(){this.pause()});if(window.history&&window.history.pushState){history.pushState({},null,d.data("back"))}})},bindPopState:function(){b(window).on("popstate",function(){b(".bs-modal").modal("hide")})}};b(function(){a.init()})})(jQuery);